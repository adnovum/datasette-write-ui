{% extends "default:row.html" %}

{% block content %}

  {{ super() }}

  <a href="/-/edit?db={{database}}&table={{table}}&pks={{primary_key_values | tojson | urlencode}}">Edit</a>
  <button id="delete">Delete</button>


  <script>
    const db = {{database | tojson}};
    const table = {{table | tojson}};
    const pks = {{ primary_key_values | tojson }};
    const deleteButton = document.querySelector('#delete');

    deleteButton.addEventListener('click', () => {
      if(window.confirm("are you sure you want to delete this row?")) {
        fetch( `/${db}/${table}/${pks.join(',')}/-/delete`, {
          method: "POST",
          credentials: 'include',
          headers: {'Content-Type': 'application/json'}
        }).then(async response => {
          const data = await response.json();
          if(response.status < 200 || response.status > 299 || !data.ok) {
            alert("errored")
          }else {
            alert("success")
          }
        }).catch(error => {
          alert("errored")
        });
      }
    })
  </script>

{% endblock %}
