function ie(e){let i=document.createElement("template");return i.innerHTML=e,document.importNode(i.content,!0)}function se(e){let i=document.createElementNS("http://www.w3.org/2000/svg","g");return i.innerHTML=e,i}var E=Object.assign(X(ie,e=>{if(e.firstChild===null)return null;if(e.firstChild===e.lastChild)return e.removeChild(e.firstChild);let i=document.createElement("span");return i.appendChild(e),i}),{fragment:X(ie,e=>e)}),et=Object.assign(X(se,e=>e.firstChild===null?null:e.firstChild===e.lastChild?e.removeChild(e.firstChild):e),{fragment:X(se,e=>{let i=document.createDocumentFragment();for(;e.firstChild;)i.appendChild(e.firstChild);return i})}),Oe=9,$e=10,De=12,Le=13,Me=32,Ue=65,xe=90,Re=97,Be=122,I=60,T=62,N=47,m=45,W=33,Q=61,re=34,oe=39,Ie=63,p=1,ae=2,le=3,V=4,P=5,g=6,Y=7,H=8,G=9,J=10,Z=11,F=12,K=13,M=14,ce=15,ue=16,y=17,de=18,fe=19,he=20,pe=21,z=22,U=23,Te=24,Ee=25,A=26,_e=27,me=28,Ae=29,Pe=128,be=1,He=8,Ge=1,Ne="http://www.w3.org/2000/svg",O="http://www.w3.org/1999/xlink",ye="http://www.w3.org/XML/1998/namespace",Se="http://www.w3.org/2000/xmlns/",ge=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),q=new Map([["xlink:actuate",O],["xlink:arcrole",O],["xlink:href",O],["xlink:role",O],["xlink:show",O],["xlink:title",O],["xlink:type",O],["xml:lang",ye],["xml:space",ye],["xmlns",Se],["xmlns:xlink",Se]]);function X(e,i){return function({raw:r}){let t=p,o="",f,c,h,d,_=0;for(let a=0,b=arguments.length;a<b;++a){let l=r[a];if(a>0){let n=arguments[a];switch(t){case A:{if(n!=null){let u=`${n}`;if(Ce(c))o+=u.replace(/[<]/g,D);else{if(new RegExp(`</${c}[\\s>/]`,"i").test(o.slice(-c.length-2)+u))throw new Error("unsafe raw text");o+=u}}break}case p:{n==null||(n instanceof Node||typeof n!="string"&&n[Symbol.iterator]||/(?:^|>)$/.test(r[a-1])&&/^(?:<|$)/.test(l)?(o+="<!--::"+a+"-->",_|=Pe):o+=`${n}`.replace(/[<&]/g,D));break}case G:{t=F;let u;if(/^[\s>]/.test(l)){if(n==null||n===!1){o=o.slice(0,h-r[a-1].length);break}if(n===!0||(u=`${n}`)==""){o+="''";break}if(r[a-1].slice(h,d)==="style"&&ee(n)||typeof n=="function"){o+="::"+a,_|=be;break}}if(u===void 0&&(u=`${n}`),u==="")throw new Error("unsafe unquoted empty string");o+=u.replace(/^['"]|[\s>&]/g,D);break}case F:{o+=`${n}`.replace(/[\s>&]/g,D);break}case Z:{o+=`${n}`.replace(/['&]/g,D);break}case J:{o+=`${n}`.replace(/["&]/g,D);break}case g:{if(ee(n)){o+="::"+a+"=''",_|=be;break}throw new Error("invalid binding")}case y:break;default:throw new Error("invalid binding")}}for(let n=0,u=l.length;n<u;++n){let s=l.charCodeAt(n);switch(t){case p:{s===I&&(t=ae);break}case ae:{s===W?t=Ee:s===N?t=le:j(s)?(f=n,c=void 0,t=V,--n):s===Ie?(t=P,--n):(t=p,--n);break}case le:{j(s)?(t=V,--n):s===T?t=p:(t=P,--n);break}case V:{C(s)?(t=g,c=R(l,f,n)):s===N?t=M:s===T&&(c=R(l,f,n),t=x(c)?A:p);break}case g:{C(s)||(s===N||s===T?(t=Y,--n):s===Q?(t=H,h=n+1,d=void 0):(t=H,--n,h=n+1,d=void 0));break}case H:{C(s)||s===N||s===T?(t=Y,--n,d=n):s===Q&&(t=G,d=n);break}case Y:{C(s)||(s===N?t=M:s===Q?t=G:s===T?t=x(c)?A:p:(t=H,--n,h=n+1,d=void 0));break}case G:{C(s)||(s===re?t=J:s===oe?t=Z:s===T?t=x(c)?A:p:(t=F,--n));break}case J:{s===re&&(t=K);break}case Z:{s===oe&&(t=K);break}case F:{C(s)?t=g:s===T&&(t=x(c)?A:p);break}case K:{C(s)?t=g:s===N?t=M:s===T?t=x(c)?A:p:(t=g,--n);break}case M:{s===T?t=p:(t=g,--n);break}case P:{s===T&&(t=p);break}case ce:{s===m?t=ue:s===T?t=p:(t=y,--n);break}case ue:{s===m?t=U:s===T?t=p:(t=y,--n);break}case y:{s===I?t=de:s===m&&(t=z);break}case de:{s===W?t=fe:s!==I&&(t=y,--n);break}case fe:{s===m?t=he:(t=y,--n);break}case he:{s===m?t=pe:(t=U,--n);break}case pe:{t=U,--n;break}case z:{s===m?t=U:(t=y,--n);break}case U:{s===T?t=p:s===W?t=Te:s!==m&&(t=y,--n);break}case Te:{s===m?t=z:s===T?t=p:(t=y,--n);break}case Ee:{s===m&&l.charCodeAt(n+1)===m?(t=ce,++n):(t=P,--n);break}case A:{s===I&&(t=_e);break}case _e:{s===N?t=me:(t=A,--n);break}case me:{j(s)?(f=n,t=Ae,--n):(t=A,--n);break}case Ae:{C(s)&&c===R(l,f,n)?t=g:s===N&&c===R(l,f,n)?t=M:s===T&&c===R(l,f,n)?t=p:j(s)||(t=A,--n);break}default:{t=void 0;break}}}o+=l}let S=e(o),v=document.createTreeWalker(S,_,null,!1),w=[];for(;v.nextNode();){let a=v.currentNode;switch(a.nodeType){case Ge:{let b=a.attributes;for(let l=0,n=b.length;l<n;++l){let{name:u,value:s}=b[l];if(/^::/.test(u)){let $=arguments[+u.slice(2)];we(a,u),--l,--n;for(let L in $){let k=$[L];k==null||k===!1||(typeof k=="function"?a[L]=k:L==="style"&&ee(k)?ke(a[L],k):Fe(a,L,k===!0?"":k))}}else if(/^::/.test(s)){let $=arguments[+s.slice(2)];we(a,u),--l,--n,typeof $=="function"?a[u]=$:ke(a[u],$)}}break}case He:{if(/^::/.test(a.data)){let b=a.parentNode,l=arguments[+a.data.slice(2)];if(l instanceof Node)b.insertBefore(l,a);else if(typeof l!="string"&&l[Symbol.iterator])if(l instanceof NodeList||l instanceof HTMLCollection)for(let n=l.length-1,u=a;n>=0;--n)u=b.insertBefore(l[n],u);else for(let n of l)n!=null&&b.insertBefore(n instanceof Node?n:document.createTextNode(n),a);else b.insertBefore(document.createTextNode(l),a);w.push(a)}break}}}for(let a of w)a.parentNode.removeChild(a);return i(S)}}function D(e){return`&#${e.charCodeAt(0).toString()};`}function j(e){return Ue<=e&&e<=xe||Re<=e&&e<=Be}function C(e){return e===Oe||e===$e||e===De||e===Me||e===Le}function ee(e){return e&&e.toString===Object.prototype.toString}function x(e){return e==="script"||e==="style"||Ce(e)}function Ce(e){return e==="textarea"||e==="title"}function R(e,i,r){return e.slice(i,r).toLowerCase()}function Fe(e,i,r){if(e.namespaceURI===Ne&&(i=i.toLowerCase(),i=ge.get(i)||i,q.has(i))){e.setAttributeNS(q.get(i),i,r);return}e.setAttribute(i,r)}function we(e,i){if(e.namespaceURI===Ne&&(i=i.toLowerCase(),i=ge.get(i)||i,q.has(i))){e.removeAttributeNS(q.get(i),i);return}e.removeAttribute(i)}function ke(e,i){for(let r in i){let t=i[r];r.startsWith("--")?e.setProperty(r,t):e[r]=t}}var B=JSON.parse(document.querySelector("script#datasette-write-ui-permissions").textContent);function je(e,i,r){return fetch(`/-/datasette-write-ui/edit-row-details?${new URLSearchParams({db:e,table:i,primaryKeys:r})}`).then(t=>t.json())}function qe(e,i){return fetch(`/-/datasette-write-ui/insert-row-details?${new URLSearchParams({db:e,table:i})}`).then(r=>r.json())}function Xe(e,i,r){return fetch(`/${e}/${i}/${r}/-/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async t=>{let o=await t.json();if(t.status<200||t.status>299||!o.ok)throw Error(o.errors);return o}).catch(t=>{throw t})}function We(e,i,r,t){return fetch(`/${e}/${i}/${r}/-/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(async o=>{let f=await o.json();if(o.status<200||o.status>299||!f.ok)throw Error(f.errors);return f}).catch(o=>{throw o})}function Qe(e,i,r){return fetch(`/${e}/${i}/-/insert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({row:r})}).then(async t=>{let o=await t.json();if(t.status<200||t.status>299||!o.ok)throw Error(o.errors);return o}).catch(t=>{throw t})}var te=class{constructor(i){this.root=E`<div class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="modal-title"></h2>
        <div class="modal-body"></div>
      </div>
    </div>`,document.body.appendChild(this.root),this.body=this.root.querySelector(".modal-body"),this.title=this.root.querySelector(".modal-title"),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.setTitle=this.setTitle.bind(this),this.setBody=this.setBody.bind(this),this.root.querySelector(".close").addEventListener("click",this.hide),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.hide()})}hide(){return this.root.style.display="none",this}show(){return this.root.style.display="block",this}setTitle(i){return this.title.innerText=i,this}setBody(i){return this.body.innerHTML="",this.body.appendChild(i),this}},ne=class{constructor(i){this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.toggle=this.toggle.bind(this),this.addButton=this.addButton.bind(this),this.root=E`<span class="row-icon">
      <button class="icon">&#9881;</button>
      <div class="menu"></div>
    </span>`,i.appendChild(this.root),this.icon=this.root.querySelector(".icon"),this.menu=this.root.querySelector(".menu"),this.icon.addEventListener("click",r=>{r.stopPropagation(),this.toggle()}),document.addEventListener("click",this.hide),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.hide()}),this.menu.addEventListener("click",r=>{r.stopPropagation()})}hide(){this.menu.style.display="none"}show(){this.menu.style.display="block"}toggle(){this.menu.style.display==="block"?this.hide():this.show()}addButton(i,r){return this.menu.appendChild(E`<button onClick=${r}>${i}</button>`),this}};function Ve(e){return e.type==="int"||e.type==="float"||e.type==="INT"?E`<input
      type="number"
      value=${e.value}
      name=${e.key}
      id=${e.key}
      disabled=${!e.editable}
      step=${e.type==="int"?1:.01}
    />`:e.type==="str"||e.type=="TEXT"?E`<textarea
        name=${e.key}
        id=${e.key}
        disabled=${!e.editable}>${e.value}`:E`<p>Unsupported type ${e.type} for ${e.key}</p>`}function Ye(e){return e.affinity==="int"||e.affinity==="real"||e.affinity==="numeric"?E`<input
      type="number"
      name=${e.name}
      id=${e.name}
      step=${e.affinity==="int"?1:.01}
    />`:e.affinity=="text"?E`<textarea
        name=${e.name}
        id=${e.name}>${e.value}`:E`<p>Unsupported type ${e.type} for ${e.name}</p>`}function Je(e,i,r){return async function(){let o=await je(e,i,r),f=new Map;function c(d){d.preventDefault();let _={};for(let[v,w]of f.entries()){if(w.disabled)continue;let a=w.type==="number"?w.valueAsNumber:w.value;console.log(v,w,a),_[v]=a}We(e,i,r,{update:_,return:!0}).then(()=>window.location.reload())}let h=E` <form onSubmit=${c}>
      <div>
        <div style="display: grid; grid-template-columns: 200px auto;">
          ${o.fields.map(d=>{let _=Ve(d);return f.set(d.key,_),E.fragment`
                <div> <label for=${d.key}>${d.key}</label> ${d.pk?"\u{1F511}":""} </div>
                <div> ${_} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;ve.setBody(h).setTitle(`Editing ${e}/${i}/${r}`).show()}}function Ze(e,i){return async function(){let{fields:t}=await qe(e,i),o=new Map;function f(h){h.preventDefault();let d={};for(let[_,S]of o.entries()){if(S.disabled)continue;let v=S.type==="number"?S.valueAsNumber:S.value;d[_]=v}Qe(e,i,d).then(()=>window.location.reload())}let c=E` <form onSubmit=${f}>
      <div>
        <div style="display: grid; grid-template-columns: 200px auto;">
          ${t.map(h=>{let d=Ye(h);return o.set(h.name,d),E.fragment`
                <div> <label for=${h.name}>${h.name}</label></div>
                <div> ${d} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;ve.setBody(c).setTitle(`Inserting into ${e}/${i}`).show()}}function Ke(e,i,r){return function(){window.confirm(`Are you sure you want to delete ${e}/${i}/${r}?`)&&Xe(e,i,r).then(()=>window.location.reload())}}var ve=new te,ze=document.querySelectorAll("table.rows-and-columns td.type-pk");if(B.can_update||B.can_delete)for(let e of ze){let i=e.querySelector("a").getAttribute("href"),[r,t,o,f]=i.split("/"),c=new ne(e);if(B.can_update){let h=Je(t,o,f);c.addButton("Edit",h)}if(B.can_delete){let h=Ke(t,o,f);c.addButton("Delete",h)}}B.can_insert&&document.querySelector("#datasette-write-ui-insert-button").addEventListener("click",async()=>{let[e,i,r]=window.location.pathname.split("/");Ze(i,r)()});
